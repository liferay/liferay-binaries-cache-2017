{"version":3,"sources":["../src/index.js"],"names":["t","types","visitor","Identifier","exit","path","state","node","name","parent","isCallExpression","argument","arguments","isLiteral","value","moduleName","isPackageName","endsWith","substring","length","normalizeCount","Program","babelIpc","get","log","info","firstSlashIndex","indexOf","restOfModuleName","startsWith"],"mappings":";;;;;;kBAYe,gBAAqB;AAAA,KAAJA,CAAI,QAAXC,KAAW;;AACnC,QAAO;AACNC,WAAS;AACRC,eAAY;AACXC,QADW,gBACNC,IADM,EACAC,KADA,EACO;AAAA,SACVC,IADU,GACFF,IADE,CACVE,IADU;;;AAGjB,SAAIA,KAAKC,IAAL,IAAa,SAAjB,EAA4B;AAC3B,UAAMC,SAASJ,KAAKI,MAApB;;AAEA,UAAIT,EAAEU,gBAAF,CAAmBD,MAAnB,CAAJ,EAAgC;AAC/B,WAAME,WAAWF,OAAOG,SAAP,CAAiB,CAAjB,CAAjB;;AAEA,WAAIZ,EAAEa,SAAF,CAAYF,QAAZ,KAAyBA,SAASG,KAAtC,EAA6C;AAC5C,YAAIC,aAAaJ,SAASG,KAA1B;;AAEA,YACC,OAAOC,UAAP,KAAsB,QAAtB,IACA,CAACC,cAAcD,UAAd,CAFF,EAGE;AACD,aAAIA,WAAWE,QAAX,CAAoB,KAApB,CAAJ,EAAgC;AAC/BF,uBAAaA,WAAWG,SAAX,CACZ,CADY,EAEZH,WAAWI,MAAX,GAAoB,CAFR,CAAb;AAIA;;AAED,aAAIJ,WAAWE,QAAX,CAAoB,GAApB,CAAJ,EAA8B;AAC7BF,uBAAaA,WAAWG,SAAX,CACZ,CADY,EAEZH,WAAWI,MAAX,GAAoB,CAFR,CAAb;AAIA;AACD;;AAED,YAAI,CAACb,MAAMc,cAAX,EAA2B;AAC1Bd,eAAMc,cAAN,GAAuB,CAAvB;AACA,SAFD,MAEO;AACNd,eAAMc,cAAN;AACA;;AAEDT,iBAASG,KAAT,GAAiBC,UAAjB;AACA;AACD;AACD;AACD;AA1CU,IADJ;AA6CRM,YAAS;AACRjB,QADQ,gBACHC,IADG,EACGC,KADH,EACU;AACjB,SAAIA,MAAMc,cAAV,EAA0B;AAAA,0BACXE,SAASC,GAAT,CAAajB,KAAb,EAAoB;AAAA,cAAO;AACxCkB,aAAK;AADmC,QAAP;AAAA,OAApB,CADW;AAAA,UAClBA,GADkB,iBAClBA,GADkB;;AAKzBA,UAAIC,IAAJ,CACC,oBADD,EAEC,YAFD,EAGCnB,MAAMc,cAHP,EAIC,UAJD;AAMA;AACD;AAdO;AA7CD;AADH,EAAP;AAgEA,C;;AAvED;;IAAYE,Q;;AACZ;;;;;;;;AAwEA;;;;;AAKA,SAASN,aAAT,CAAuBD,UAAvB,EAAmC;AAClC,KAAMW,kBAAkBX,WAAWY,OAAX,CAAmB,GAAnB,CAAxB;;AAEA,KAAID,mBAAmB,CAAC,CAAxB,EAA2B;AAC1B,SAAO,IAAP;AACA;;AAED,KAAME,mBAAmBb,WAAWG,SAAX,CAAqBQ,kBAAkB,CAAvC,CAAzB;;AAEA,KAAIX,WAAWc,UAAX,CAAsB,GAAtB,KAA8BD,iBAAiBD,OAAjB,CAAyB,GAAzB,KAAiC,CAAC,CAApE,EAAuE;AACtE,SAAO,IAAP;AACA;;AAED,QAAO,KAAP;AACA;;AAzFD;;;AATA","file":"index.js","sourcesContent":["/**\n * Â© 2017 Liferay, Inc. <https://liferay.com>\n *\n * SPDX-License-Identifier: LGPL-3.0-or-later\n */\n\nimport * as babelIpc from 'liferay-npm-build-tools-common/lib/babel-ipc';\nimport PluginLogger from 'liferay-npm-build-tools-common/lib/plugin-logger';\n\n/**\n * @return {object} a babel visitor\n */\nexport default function({types: t}) {\n\treturn {\n\t\tvisitor: {\n\t\t\tIdentifier: {\n\t\t\t\texit(path, state) {\n\t\t\t\t\tconst {node} = path;\n\n\t\t\t\t\tif (node.name == 'require') {\n\t\t\t\t\t\tconst parent = path.parent;\n\n\t\t\t\t\t\tif (t.isCallExpression(parent)) {\n\t\t\t\t\t\t\tconst argument = parent.arguments[0];\n\n\t\t\t\t\t\t\tif (t.isLiteral(argument) && argument.value) {\n\t\t\t\t\t\t\t\tlet moduleName = argument.value;\n\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\ttypeof moduleName === 'string' &&\n\t\t\t\t\t\t\t\t\t!isPackageName(moduleName)\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\tif (moduleName.endsWith('.js')) {\n\t\t\t\t\t\t\t\t\t\tmoduleName = moduleName.substring(\n\t\t\t\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t\t\t\tmoduleName.length - 3\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (moduleName.endsWith('/')) {\n\t\t\t\t\t\t\t\t\t\tmoduleName = moduleName.substring(\n\t\t\t\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t\t\t\tmoduleName.length - 1\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (!state.normalizeCount) {\n\t\t\t\t\t\t\t\t\tstate.normalizeCount = 1;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tstate.normalizeCount++;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\targument.value = moduleName;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tProgram: {\n\t\t\t\texit(path, state) {\n\t\t\t\t\tif (state.normalizeCount) {\n\t\t\t\t\t\tconst {log} = babelIpc.get(state, () => ({\n\t\t\t\t\t\t\tlog: new PluginLogger(),\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t\tlog.info(\n\t\t\t\t\t\t\t'normalize-requires',\n\t\t\t\t\t\t\t'Normalized',\n\t\t\t\t\t\t\tstate.normalizeCount,\n\t\t\t\t\t\t\t'requires'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t};\n}\n\n/**\n * Check whether a module name refers to a package entry point.\n * @param {String} moduleName the name of a JS module\n * @return {boolean} true if moduleName is a package name\n */\nfunction isPackageName(moduleName) {\n\tconst firstSlashIndex = moduleName.indexOf('/');\n\n\tif (firstSlashIndex == -1) {\n\t\treturn true;\n\t}\n\n\tconst restOfModuleName = moduleName.substring(firstSlashIndex + 1);\n\n\tif (moduleName.startsWith('@') && restOfModuleName.indexOf('/') == -1) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n"]}